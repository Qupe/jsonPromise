export default function jsonPromise(a,b,c,d){function e(a,b){let c=-1===(a||"").indexOf("?")?"?":"&";for(let d in b)b.hasOwnProperty(d)&&(c+=`${encodeURIComponent(d)}=${encodeURIComponent(b[d])}&`);return a+c+"callback="+d}function f(a){let b,c;b=document.createElement("script"),b.src=g,b.async=!0,b.onerror=a,b.onload=b.onreadystatechange=function(){c||this.readyState&&"loaded"!==this.readyState&&"complete"!==this.readyState||(c=!0,b.onload=b.onreadystatechange=null,b&&b.parentNode&&b.parentNode.removeChild(b))},document.getElementsByTagName("head")[0].appendChild(b)}d=d||"cb"+Math.random().toString(36).substr(2,6);let g=e(a,b);return new Promise((a,b)=>{let e;c&&(e=setTimeout(()=>{b(new Error("Request timed out"))},c)),window[d]=c=>{try{delete window[d]}catch(a){b(new Error("Cant delete callback"))}window[d]=void 0,clearTimeout(e),a(c)};f(()=>b(new Error("Script loading error")))})}
